<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Koloau | AI Control Center</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
        .dashboard-section { margin-top: 40px; }
        .bot-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .bot-card { padding: 25px; border-radius: 20px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); position: relative; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .bot-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.07); }
        .bot-card h3 { font-size: 1.1rem; margin-bottom: 15px; color: #fff; }
        .stats-row { display: flex; gap: 15px; margin-bottom: 20px; font-size: 0.85rem; }
        .stat-item { padding: 5px 12px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-active .status-dot { background: #2ecc71; box-shadow: 0 0 10px #2ecc71; }
        .status-inactive .status-dot { background: #95a5a6; }
        .bot-card .actions { display: flex; flex-wrap: wrap; gap: 10px; }
        .btn-small { border: none; padding: 10px 15px; border-radius: 12px; font-size: 0.85rem; cursor: pointer; transition: 0.3s; font-weight: 600; }
        .btn-toggle { background: #fff; color: #000; }
        .btn-delete { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
        .btn-delete:hover { background: #e74c3c; color: #fff; }
        .btn-tg { background: rgba(255, 255, 255, 0.1); color: #fff; }
        
        /* Floating labels for create form */
        .input-group label { display: block; margin-bottom: 8px; font-size: 0.9rem; opacity: 0.8; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        
        #category-tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .tab-btn { padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; font-size: 0.85rem; cursor: pointer; white-space: nowrap; transition: 0.3s; }
        .tab-btn.active { background: #fff; color: #000; }
        
        #model-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin-top: 10px; }
        .model-opt { padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 12px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05); cursor: pointer; font-size: 0.8rem; transition: 0.3s; }
        .model-opt.selected { background: #fff; color: #000; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.6s forwards; }
    </style>
  </head>
  <body>
    <div class="background-blobs">
      <div class="blob blob-1"></div>
      <div class="blob blob-2"></div>
      <div class="blob blob-3"></div>
    </div>

    <div class="container animate-fade">
      <header>
        <div class="logo">Koloau 2.1</div>
        <h1>–ö–æ–Ω—Å–æ–ª—å –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è 2026</h1>
        <p>–¶–µ–Ω—Ç—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–≤–æ–∏—Ö AI-–∞–≥–µ–Ω—Ç–æ–≤ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è.</p>
      </header>

      <main>
        <form id="bot-form" class="glass-card">
          <div class="input-group">
            <label for="token">Telegram Bot Token</label>
            <input type="text" id="token" placeholder="–ü–æ–ª—É—á–∏ —É @BotFather" required />
          </div>

          <div class="input-group">
            <label>–í—ã–±–æ—Ä –ù–µ–π—Ä–æ—Å–µ—Ç–∏ (Flagship 2026)</label>
            <div class="category-tabs" id="category-tabs"></div>
            <div id="model-list"></div>
            <input type="hidden" id="model-input" value="gpt-5" />
          </div>

          <div class="input-group">
            <label for="instructions">–õ–∏—á–Ω–æ—Å—Ç—å –∏ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</label>
            <textarea id="instructions" placeholder="–ó–∞–¥–∞–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä —Å–≤–æ–µ–≥–æ –±—É–¥—É—â–µ–≥–æ –ò–ò..." required></textarea>
          </div>

          <button type="submit" id="submit-btn" class="main-btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ê–≥–µ–Ω—Ç–∞</button>
          <div id="status"></div>
        </form>

        <section class="dashboard-section">
            <div style="display:flex; justify-content: space-between; align-items: center;">
                <h2>üîã –¢–≤–æ–π –§–ª–æ—Ç</h2>
                <button onclick="fetchBots()" class="btn-small btn-tg">Refresh Stats</button>
            </div>
            <div id="bot-list" class="bot-list">
                <div class="glass-card" style="text-align:center; padding: 40px; opacity:0.5">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∞–∑–æ–π...</div>
            </div>
        </section>
      </main>

      <footer>
        <p>&copy; 2026 Koloau Intelligence. All rights Reserved.</p>
      </footer>
    </div>

    <script>
      let modelsData = {};
      let selectedModel = 'gpt-5';

      async function loadModels() {
          const res = await fetch('/api/models');
          modelsData = await res.json();
          renderTabs();
          renderModels('openai');
      }

      function renderTabs() {
          const container = document.getElementById('category-tabs');
          container.innerHTML = Object.keys(modelsData).map((cat, i) => `
              <div class="tab-btn ${i === 0 ? 'active' : ''}" onclick="selectCategory('${cat}', this)">${modelsData[cat].label}</div>
          `).join('');
      }

      function selectCategory(cat, btn) {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderModels(cat);
      }

      function renderModels(cat) {
          const container = document.getElementById('model-list');
          container.innerHTML = Object.keys(modelsData[cat].models).map(id => `
              <div class="model-opt ${selectedModel === id ? 'selected' : ''}" onclick="selectModel('${id}', this)">
                  ${modelsData[cat].models[id]}
              </div>
          `).join('');
      }

      function selectModel(id, el) {
          selectedModel = id;
          document.getElementById('model-input').value = id;
          document.querySelectorAll('.model-opt').forEach(o => o.classList.remove('selected'));
          el.classList.add('selected');
      }

      async function fetchBots() {
          try {
              const res = await fetch('/api/bots/list');
              const data = await res.json();
              const container = document.getElementById('bot-list');
              
              if (!data.bots || data.bots.length === 0) {
                  container.innerHTML = '<div class="glass-card" style="text-align:center; padding: 40px; opacity:0.5">–§–ª–æ—Ç –ø—É—Å—Ç. –î–æ–±–∞–≤—å –ø–µ—Ä–≤—ã–π –∫–æ—Ä–∞–±–ª—å –≤—ã—à–µ. üö¢</div>';
                  return;
              }

              container.innerHTML = data.bots.map((b, i) => `
                  <div class="bot-card glass-card ${b.is_active ? 'status-active' : 'status-inactive'}" style="animation: fadeIn ${0.3 + i*0.1}s forwards">
                      <h3>${b.token.substring(0, 15)}...</h3>
                      <div class="stats-row">
                          <span class="stat-item"><span class="status-dot"></span>${b.is_active ? 'Online' : 'Paused'}</span>
                          <span class="stat-item">üí¨ ${b.message_count || 0} msgs</span>
                          <span class="stat-item">‚ö°Ô∏è ${b.model}</span>
                      </div>
                      <div class="actions">
                          <button class="btn-small btn-toggle" onclick="toggleBot('${b.token}')">
                              ${b.is_active ? '–ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É' : '–í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É'}
                          </button>
                          <button class="btn-small btn-tg" onclick="copyId('${b.token}')">Copy ID</button>
                          <button class="btn-small btn-tg" onclick="window.open('https://t.me/${b.token.split(':')[0]}', '_blank')">‚ÜóÔ∏è Telegram</button>
                          <button class="btn-small btn-delete" onclick="deleteBot('${b.token}')">–£–¥–∞–ª–∏—Ç—å</button>
                      </div>
                  </div>
              `).join('');
          } catch(e) { console.error(e); }
      }

      async function toggleBot(token) {
          await fetch('/api/bots/toggle', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ token })
          });
          fetchBots();
      }

      async function deleteBot(token) {
          if (!confirm('–ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –±–æ—Ç–∞ –∏ –≤—Å–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ?')) return;
          await fetch('/api/bots/stop', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ token })
          });
          fetchBots();
      }

      function copyId(token) {
          navigator.clipboard.writeText(token);
          alert('–¢–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
      }

      document.getElementById("bot-form").addEventListener("submit", async (e) => {
          e.preventDefault();
          const btn = document.getElementById("submit-btn");
          const status = document.getElementById("status");

          const data = {
            token: document.getElementById("token").value,
            model: selectedModel,
            instructions: document.getElementById("instructions").value,
          };

          btn.disabled = true;
          btn.innerText = "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...";

          try {
            const response = await fetch("/api/bots/create", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });
            const result = await response.json();
            if (result.success) {
                status.innerHTML = `<span class="success">–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤–æ —Ñ–ª–æ—Ç!</span>`;
                fetchBots();
                document.getElementById("bot-form").reset();
            } else { status.innerHTML = `<span class="error">–û—à–∏–±–∫–∞: ${result.message}</span>`; }
          } catch (err) { status.innerHTML = `<span class="error">–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.</span>`; }
          finally { btn.disabled = false; btn.innerText = "–ó–∞–ø—É—Å—Ç–∏—Ç—å –ê–≥–µ–Ω—Ç–∞"; }
        });

      loadModels();
      fetchBots();
      // Auto-refresh stats every 30 seconds
      setInterval(fetchBots, 30000);
    </script>
  </body>
</html>
