<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Koloau | AI MAX Console</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
        .dashboard-section { margin-top: 40px; }
        .bot-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .bot-card { padding: 25px; border-radius: 20px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); position: relative; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .bot-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.07); }
        .bot-card h3 { font-size: 1.1rem; margin-bottom: 15px; color: #fff; }
        .stats-row { display: flex; gap: 15px; margin-bottom: 20px; font-size: 0.85rem; }
        .stat-item { padding: 5px 12px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-active .status-dot { background: #2ecc71; box-shadow: 0 0 10px #2ecc71; }
        .status-inactive .status-dot { background: #95a5a6; }
        .bot-card .actions { display: flex; flex-wrap: wrap; gap: 10px; }
        .btn-small { border: none; padding: 10px 15px; border-radius: 12px; font-size: 0.85rem; cursor: pointer; transition: 0.3s; font-weight: 600; }
        .btn-toggle { background: #fff; color: #000; }
        .btn-delete { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
        .btn-tg { background: rgba(255, 255, 255, 0.1); color: #fff; }
        
        .input-group label { display: block; margin-bottom: 15px; font-size: 1rem; color: #fff; font-weight: 800; }
        
        #category-tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; -ms-overflow-style: none; }
        #category-tabs::-webkit-scrollbar { display: none; }
        .tab-btn { padding: 12px 20px; background: rgba(255, 255, 255, 0.05); border-radius: 15px; font-size: 0.85rem; cursor: pointer; white-space: nowrap; transition: 0.3s; border: 1px solid rgba(255, 255, 255, 0.1); }
        .tab-btn.active { background: #fff; color: #000; font-weight: 800; border-color: #fff; box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        
        #model-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; margin-top: 5px; }
        .model-opt { padding: 15px; background: rgba(255, 255, 255, 0.03); border-radius: 15px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05); cursor: pointer; font-size: 0.85rem; transition: 0.3s; }
        .model-opt:hover { background: rgba(255, 255, 255, 0.08); border-color: rgba(255, 255, 255, 0.2); }
        .model-opt.selected { background: #fff; color: #000; font-weight: 800; transform: scale(1.05); }
        
        .main-btn { width: 100%; padding: 20px; border-radius: 20px; font-size: 1.1rem; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.6s forwards; }
    </style>
  </head>
  <body>
    <div class="background-blobs">
      <div class="blob blob-1"></div>
      <div class="blob blob-2"></div>
      <div class="blob blob-3"></div>
    </div>

    <div class="container animate-fade">
      <header>
        <div class="logo">Koloau 2.2 MAX</div>
        <h1>AI MAX Control 2026</h1>
        <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å, 50+ –º–æ–¥–µ–ª–µ–π –∏ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ç–≤–æ–∏–º —Ñ–ª–æ—Ç–æ–º –ò–ò.</p>
      </header>

      <main>
        <form id="bot-form" class="glass-card">
          <div class="input-group">
            <label for="token">Telegram Bot Token</label>
            <input type="text" id="token" placeholder="–í—Å—Ç–∞–≤—å —Ç–æ–∫–µ–Ω –æ—Ç @BotFather" required />
          </div>

          <div class="input-group">
            <label>–í—ã–±–µ—Ä–∏ –î–≤–∏–∂–æ–∫ (–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã)</label>
            <div class="category-tabs" id="category-tabs"></div>
            <div id="model-list"></div>
            <input type="hidden" id="model-input" value="gpt-5.3" />
          </div>

          <div class="input-group">
            <label for="instructions">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞</label>
            <textarea id="instructions" placeholder="–ö–µ–º –±—É–¥–µ—Ç —Ç–≤–æ–π –±–æ—Ç? –ó–∞–¥–∞–π –µ–º—É —Ä–æ–ª—å –∏ –ø—Ä–∞–≤–∏–ª–∞..." required></textarea>
          </div>

          <button type="submit" id="submit-btn" class="main-btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å MAX-–ë–æ—Ç–∞</button>
          <div id="status"></div>
        </form>

        <section class="dashboard-section">
            <div style="display:flex; justify-content: space-between; align-items: center;">
                <h2>üîã –¢–≤–æ–π –§–ª–æ—Ç (Online)</h2>
                <button onclick="fetchBots()" class="btn-small btn-tg">Refresh Data</button>
            </div>
            <div id="bot-list" class="bot-list">
                <div class="glass-card" style="text-align:center; padding: 40px; opacity:0.5">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</div>
            </div>
        </section>
      </main>

      <footer>
        <p>&copy; 2026 Koloau Intelligence MAX. Power by F5AI SDK.</p>
      </footer>
    </div>

    <script>
      let modelsData = {};
      let selectedModel = 'gpt-5.3';

      async function loadModels() {
          const res = await fetch('/api/models');
          modelsData = await res.json();
          renderTabs();
          const firstCat = Object.keys(modelsData)[0];
          renderModels(firstCat);
      }

      function renderTabs() {
          const container = document.getElementById('category-tabs');
          container.innerHTML = Object.keys(modelsData).map((cat, i) => `
              <div class="tab-btn ${i === 0 ? 'active' : ''}" onclick="selectCategory('${cat}', this)">${modelsData[cat].label}</div>
          `).join('');
      }

      function selectCategory(cat, btn) {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderModels(cat);
      }

      function renderModels(cat) {
          const container = document.getElementById('model-list');
          container.innerHTML = Object.keys(modelsData[cat].models).map(id => `
              <div class="model-opt ${selectedModel === id ? 'selected' : ''}" onclick="selectModel('${id}', this)">
                  ${modelsData[cat].models[id]}
              </div>
          `).join('');
      }

      function selectModel(id, el) {
          selectedModel = id;
          document.getElementById('model-input').value = id;
          document.querySelectorAll('.model-opt').forEach(o => o.classList.remove('selected'));
          el.classList.add('selected');
      }

      async function fetchBots() {
          try {
              const res = await fetch('/api/bots/list');
              const data = await res.json();
              const container = document.getElementById('bot-list');
              
              if (!data.bots || data.bots.length === 0) {
                  container.innerHTML = '<div class="glass-card" style="text-align:center; padding: 40px; opacity:0.5">–í –ø–æ—Ä—Ç—É –ø–æ–∫–∞ –ø—É—Å—Ç–æ. –ü–æ–¥–Ω–∏–º–∏ –ø–∞—Ä—É—Å–∞ –≤—ã—à–µ! üß≠</div>';
                  return;
              }

              container.innerHTML = data.bots.map((b, i) => `
                  <div class="bot-card glass-card ${b.is_active ? 'status-active' : 'status-inactive'}" style="animation: fadeIn ${0.3 + i*0.1}s forwards">
                      <h3>${b.token.substring(0, 15)}...</h3>
                      <div class="stats-row">
                          <span class="stat-item"><span class="status-dot"></span>${b.is_active ? 'Active' : 'Paused'}</span>
                          <span class="stat-item">üí¨ ${b.message_count || 0}</span>
                          <span class="stat-item">üß† ${b.model}</span>
                      </div>
                      <div class="actions">
                          <button class="btn-small btn-toggle" onclick="toggleBot('${b.token}')">
                              ${b.is_active ? '–ü–∞—É–∑–∞' : '–ü—É—Å–∫'}
                          </button>
                          <button class="btn-small btn-tg" onclick="copyId('${b.token}')">ID</button>
                          <button class="btn-small btn-tg" onclick="window.open('https://t.me/${b.token.split(':')[0]}', '_blank')">–í @TG</button>
                          <button class="btn-small btn-delete" onclick="deleteBot('${b.token}')">üóë</button>
                      </div>
                  </div>
              `).join('');
          } catch(e) { }
      }

      async function toggleBot(token) {
          await fetch('/api/bots/toggle', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ token })
          });
          fetchBots();
      }

      async function deleteBot(token) {
          if (!confirm('–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞?')) return;
          await fetch('/api/bots/stop', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ token })
          });
          fetchBots();
      }

      function copyId(token) {
          navigator.clipboard.writeText(token);
          alert('ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
      }

      document.getElementById("bot-form").addEventListener("submit", async (e) => {
          e.preventDefault();
          const btn = document.getElementById("submit-btn");
          const status = document.getElementById("status");

          const data = {
            token: document.getElementById("token").value,
            model: selectedModel,
            instructions: document.getElementById("instructions").value,
          };

          btn.disabled = true;
          btn.innerText = "–ì–∏–ø–µ—Ä–ø—Ä—ã–∂–æ–∫...";

          try {
            const response = await fetch("/api/bots/create", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });
            const result = await response.json();
            if (result.success) {
                status.innerHTML = `<span class="success">–ë–æ—Ç –≤–æ —Ñ–ª–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω!</span>`;
                fetchBots();
                document.getElementById("bot-form").reset();
            } else { status.innerHTML = `<span class="error">–û—à–∏–±–∫–∞: ${result.message}</span>`; }
          } catch (err) { status.innerHTML = `<span class="error">–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç.</span>`; }
          finally { btn.disabled = false; btn.innerText = "–ó–∞–ø—É—Å—Ç–∏—Ç—å MAX-–ë–æ—Ç–∞"; }
        });

      loadModels();
      fetchBots();
      setInterval(fetchBots, 20000);
    </script>
  </body>
</html>
